# Fail2Ban filter for FastAPI authentication endpoints
# File: /etc/fail2ban/filter.d/fastapi-auth.conf

[Definition]

# Failregex for failed login attempts - matches our custom logging
failregex = ^.*Failed login attempt for email .* from IP <HOST>.*$
            ^.*"POST /auth/login.*" 401.*$
            ^.*"POST /auth/register.*" 400.*$

# Ignore successful requests
ignoreregex = ^.*Successful login for email .* from IP.*$
              ^.*"POST /auth/login.*" 200.*$
              ^.*"POST /auth/register.*" 201.*$

# Date format (ISO 8601)
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S